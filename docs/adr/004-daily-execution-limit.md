# ADR 004: 1日1回の実行制限

## ステータス

承認済み

## 背景

Notion Metrics Recorderは定期的に実行されることを想定していますが、以下の要件がありました：
1. 通常は1日1回のみ実行する
2. 必要に応じて手動で強制実行できる
3. 実行履歴を記録する
4. 誤って複数回実行されることを防ぐ

## 決定

以下の方針を採用します：
1. フラグファイルを使用して1日1回の実行制限を実装
   - ファイル名: `/tmp/notion_metrics_{YYYYMMDD}.flag`
   - 実行時に作成され、同じ日付の実行を防止
2. `--force`オプションによる強制実行機能を追加
3. 実行制限の状態をログに記録
4. フラグファイルは日付ごとに自動的に切り替わる

## 影響

### メリット
- 意図しない複数回実行を防止
- 必要に応じて手動実行が可能
- 実行履歴が明確に記録される
- シンプルな実装で保守が容易

### デメリット
- `/tmp`ディレクトリへの依存
- フラグファイルの管理が必要
- システム時刻に依存

### 中立
- パフォーマンスへの影響なし
- 既存の機能への影響なし
- 設定の変更は不要 